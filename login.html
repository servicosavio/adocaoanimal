<!DOCTYPE html>
<html lang="pt-br">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Login - Projeto</title>
  <link rel="stylesheet" href="./css/test.css" />
</head>

<body>

  <main class="main">
    <section class="container org">
      <div class="form-wrap" role="region" aria-labelledby="tituloLogin">
        <h1 id="tituloLogin" class="title">Entrar no perfil</h1>

        <form id="form-login" class="login-form" autocomplete="on">
          <label class="field-label" for="email">E-mail</label>
          <input id="email" name="email" class="input-field org-input" type="email" placeholder="Seu e-mail" required
            autocomplete="email" />

          <label class="field-label" for="password">Senha</label>
          <div class="password-wrapper org-input">
            <input id="password" name="password" class="input-field input-password" type="password"
              placeholder="Sua senha" required autocomplete="current-password" />
            <button type="button" aria-label="Mostrar senha" class="btn-eye" id="togglePassword"><img src="img1.png"
                alt="O"></button>
          </div>

          <button class="btn-submit" type="submit">Entrar</button>

          <p id="login-message" style="margin-top:12px;color:var(--cor-texto)"></p>
        </form>

        <div class="modo-treino" style="border-top: 2px solid #ccc; margin-top: 24px; padding-top: 20px;">
          <h2 class="title" style="font-size: 1.25rem;">Modo Treino</h2>
          <p style="color:var(--cor-texto); margin-bottom: 12px;">
            Agora, invente a sua pr√≥pria senha! Digite abaixo para ver o n√≠vel dela.
          </p>

          <label class="field-label" for="treino-senha">Teste sua senha aqui:</label>
          <div class="password-wrapper org-input" style="margin-bottom: 10px;">
            <input id="treino-senha" class="input-field input-password" type="text"
              placeholder="Digite para testar..." />
            <button type="button" aria-label="Limpar campo" class="btn-eye" id="limparTreino"><img src="img3.png" alt="LIMPAR"></button>
          </div>

          <div id="barra-forca"
            style="height: 10px; background: #eee; border-radius: 5px; overflow: hidden; margin-bottom: 5px;">
            <div id="barra-progresso" style="height: 100%; width: 0%; background: crimson; transition: all 0.3s ease;">
            </div>
          </div>

          <p id="treino-message" style="font-weight: bold; min-height: 20px;"></p>
        </div>

      </div>
    </section>
  </main>

  <script src="./js/auth.js"></script>
  <script>
    // =============================================
    // PARTE 1: C√ÅLCULO DE FOR√áA DA SENHA
    // =============================================
    function calcularNivelSenha(senha) {
      let score = 0;

      const criterios = {
        maiuscula: /[A-Z]/.test(senha),
        minuscula: /[a-z]/.test(senha),
        numero: /[0-9]/.test(senha),
        simbolo: /[^A-Za-z0-9]/.test(senha),
      };

      // Pontos por diversidade
      if (criterios.maiuscula) score += 15;
      if (criterios.minuscula) score += 15;
      if (criterios.numero) score += 20;
      if (criterios.simbolo) score += 25;

      // Pontos por tamanho
      if (senha.length >= 8) score += 10;
      if (senha.length >= 12) score += 15;

      // Penaliza√ß√£o por repeti√ß√µes
      if (/(\w)\1{2,}/.test(senha)) score -= 10;

      // Normaliza entre 0 e 100
      score = Math.max(0, Math.min(100, score));

      // Define n√≠vel com base no score
      let nivel, msg, cor;
      switch (true) {
        case senha.length === 0:
          nivel = 0;
          msg = '';
          cor = 'crimson';
          break;
        case senha.length < 8:
          nivel = 1;
          msg = '‚ö†Ô∏è Muito curta! Use pelo menos 8 caracteres.';
          cor = 'crimson';
          break;
        case score < 40:
          nivel = 2;
          msg = 'ü•± Senha fraca. Misture letras, n√∫meros e s√≠mbolos.';
          cor = 'orange';
          break;
        case score < 70:
          nivel = 3;
          msg = 'üí™ Boa! J√° est√° mais segura, mas pode melhorar.';
          cor = 'dodgerblue';
          break;
        case score < 90:
          nivel = 4;
          msg = 'üëè √ìtima senha! Est√° bem forte.';
          cor = 'mediumseagreen';
          break;
        default:
          nivel = 5;
          msg = 'üèÜ Perfeita! Seguran√ßa m√°xima.';
          cor = 'limegreen';
      }

      return {
        nivel,
        msg,
        cor,
        larguraBarra: Math.min(score, 100),
      };
    }


    // =============================================
    // PARTE 2: L√ìGICA DE LOGIN + MODO TREINO
    // =============================================
    document.addEventListener('DOMContentLoaded', () => {
      // ---- LOGIN ----
      Auth.seedSampleUsers();

      const loginForm = document.getElementById('form-login');
      const loginMsg = document.getElementById('login-message');
      const toggle = document.getElementById('togglePassword');
      const pwd = document.getElementById('password');

      toggle.addEventListener('click', () => {
        const isHidden = pwd.type === 'password';

        // Alterna o tipo do campo
        pwd.type = isHidden ? 'text' : 'password';

        // Atualiza a imagem e o t√≠tulo
        toggle.innerHTML = isHidden
          ? '<img src="img2.png" alt="Ocultar senha">'
          : '<img src="img1.png" alt="Mostrar senha">';

        toggle.title = isHidden ? 'Ocultar senha' : 'Mostrar senha';
      });

      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        loginMsg.textContent = '';
        const email = document.getElementById('email').value.trim();
        const password = pwd.value;
        const result = Auth.loginUser(email, password);

        if (result.ok) {
          const { user } = result;
          const coresNivel = ['crimson', 'orange', 'blue', 'green'];
          loginMsg.style.color = coresNivel[user.nivel - 1] || 'black';
          loginMsg.textContent = user.msgSucesso;
        } else {
          loginMsg.style.color = 'crimson';
          loginMsg.textContent = `${result.message} üòü Verifique o olhinho üëÅÔ∏è`;
        }
      });


      // ---- TREINO DE SENHA ----
      const treinoInput = document.getElementById('treino-senha');
      const treinoMsg = document.getElementById('treino-message');
      const barraProgresso = document.getElementById('barra-progresso');
      const btnLimpar = document.getElementById('limparTreino');

      treinoInput.addEventListener('input', () => {
        const senha = treinoInput.value;
        const analise = calcularNivelSenha(senha);

        treinoMsg.textContent = analise.msg;
        treinoMsg.style.color = analise.cor;

        barraProgresso.style.width = analise.larguraBarra + '%';
        barraProgresso.style.backgroundColor = analise.cor;
        barraProgresso.style.transition = 'width 0.3s ease, background-color 0.3s ease';
      });

      btnLimpar.addEventListener('click', () => {
        treinoInput.value = '';
        treinoInput.dispatchEvent(new Event('input'));
      });
    });
  </script>

</body>

</html>