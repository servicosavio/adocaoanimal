<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login - Projeto</title>
  <link rel="stylesheet" href="./css/test.css" />
</head>
<body>

  <main class="main">
    <section class="container org">
      <div class="form-wrap" role="region" aria-labelledby="tituloLogin">
        <h1 id="tituloLogin" class="title">Entrar no perfil</h1>

        <form id="form-login" class="login-form" autocomplete="on">
          <label class="field-label" for="email">E-mail</label>
          <input id="email" name="email" class="input-field org-input" type="email" placeholder="Seu e-mail" required autocomplete="email" />

          <label class="field-label" for="password">Senha</label>
          <div class="password-wrapper org-input">
            <input id="password" name="password" class="input-field input-password" type="password" placeholder="Sua senha" required autocomplete="current-password" />
            <button type="button" aria-label="Mostrar senha" class="btn-eye" id="togglePassword">üëÅÔ∏è</button>
          </div>

         <button class="btn-submit" type="submit">Entrar</button>
          
          <p id="login-message" style="margin-top:12px;color:var(--cor-texto)"></p>
        </form>

        <div class="modo-treino" style="border-top: 2px solid #ccc; margin-top: 24px; padding-top: 20px;">
          <h2 class="title" style="font-size: 1.25rem;">Modo Treino</h2>
          <p style="color:var(--cor-texto); margin-bottom: 12px;">
            Agora, invente a sua pr√≥pria senha! Digite abaixo para ver o n√≠vel dela.
          </p>
          
          <label class="field-label" for="treino-senha">Teste sua senha aqui:</label>
          <div class="password-wrapper org-input" style="margin-bottom: 10px;">
            <input id="treino-senha" class="input-field input-password" type="text" placeholder="Digite para testar..." />
            <button type="button" aria-label="Limpar campo" class="btn-eye" id="limparTreino">‚ùå</button>
          </div>
          
          <div id="barra-forca" style="height: 10px; background: #eee; border-radius: 5px; overflow: hidden; margin-bottom: 5px;">
             <div id="barra-progresso" style="height: 100%; width: 0%; background: crimson; transition: all 0.3s ease;"></div>
          </div>
          
          <p id="treino-message" style="font-weight: bold; min-height: 20px;"></p>
        </div>

      </div> </section>
  </main>

  <script src="./js/auth.js"></script>
    <script>
    // =============================================
    // PARTE 1: FUN√á√ÉO DA CALCULADORA DE SENHA
    // =============================================
    function calcularNivelSenha(senha) {
      let score = 0;
      let msg = '';
      let nivel = 0; // N√≠vel 0 a 4
      let cor = 'crimson'; // Cor inicial (vermelha)

      // Crit√©rios de pontua√ß√£o
      const temMaiuscula = /[A-Z]/.test(senha);
      const temMinuscula = /[a-z]/.test(senha);
      const temNumero = /[0-9]/.test(senha);
      const temSimbolo = /[^A-Za-z0-9]/.test(senha);

      if (senha.length >= 8) score++;
      if (senha.length >= 12) score++; // B√¥nus por ser longa
      if (temMaiuscula) score++;
      if (temMinuscula) score++;
      if (temNumero) score++;
      if (temSimbolo) score++;

      // Mapear score para n√≠vel (0-4)
      if (senha.length < 8) {
        nivel = 0;
        msg = 'Muito curta! üòü Deve ter pelo menos 8 caracteres.';
        cor = 'crimson';
      } else if (score <= 2) { // S√≥ tem 1 tipo (ex: '12345678' ou 'bobzinhobob')
        nivel = 1;
        msg = 'Cuidado! ü•≥ Senha fraca. √â f√°cil de adivinhar.';
        cor = 'crimson';
      } else if (score === 3 || score === 4) { // Mistura 2 ou 3 tipos
        nivel = 2;
        msg = 'Est√° melhorando! üòÑ Tente misturar mai√∫sculas, n√∫meros e s√≠mbolos.';
        cor = 'orange';
      } else if (score === 5) { // Mistura 3 tipos + √© longa OU 4 tipos
        nivel = 3;
        msg = 'Muito bem! üëè Senha forte. Quase l√°!';
        cor = 'blue';
      } else { // score 6+ (longa e com tudo)
        nivel = 4;
        msg = 'PERFEITO! üèÜ N√≠vel Mestre! Voc√™ misturou tudo!';
        cor = 'green';
      }

      // N√≠vel 0 √© 0% de barra, N√≠vel 4 √© 100%
      const larguraBarra = (nivel / 4) * 100;
      
      return { nivel, msg, cor, larguraBarra };
    }


    // =============================================
    // PARTE 2: L√ìGICA DA AULA (LOGIN + TREINO)
    // =============================================
    document.addEventListener('DOMContentLoaded', () => {
      Auth.seedSampleUsers(); // Garante os usu√°rios de teste (Zilda, Jorge, etc.)
      
      // --- L√≥gica do Formul√°rio de LOGIN (Jogo dos Vizinhos) ---
      const loginForm = document.getElementById('form-login');
      const loginMsg = document.getElementById('login-message');
      const toggle = document.getElementById('togglePassword');
      const pwd = document.getElementById('password');

      toggle.addEventListener('click', () => {
        const type = pwd.type === 'password' ? 'text' : 'password';
        pwd.type = type;
        toggle.textContent = type === 'password' ? 'üëÅÔ∏è' : 'üôà';
      });

      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        loginMsg.textContent = '';
        const email = document.getElementById('email').value.trim();
        const password = pwd.value;
        const result = Auth.loginUser(email, password);
        
        if (result.ok) {
          const user = result.user; // Pegamos os dados do usu√°rio (Zilda, etc.)
          
          // Define a cor baseado no n√≠vel PEDAG√ìGICO (1-4)
          if (user.nivel === 1) msg.style.color = 'crimson';
          else if (user.nivel === 2) msg.style.color = 'orange';
          else if (user.nivel === 3) msg.style.color = 'blue';
          else if (user.nivel === 4) msg.style.color = 'green';
          
          // Mostra a mensagem personalizada que veio do auth.js!
          loginMsg.textContent = user.msgSucesso; 
          
        } else {
          loginMsg.style.color = 'crimson';
          loginMsg.textContent = result.message + ' üòü Tente de novo! Verifique o olhinho üëÅÔ∏è'; 
        }
      });


      // --- L√≥gica do MODO TREINO (Calculadora) ---
      const treinoInput = document.getElementById('treino-senha');
      const treinoMsg = document.getElementById('treino-message');
      const barraProgresso = document.getElementById('barra-progresso');
      const btnLimpar = document.getElementById('limparTreino');

      // Evento "input" roda a cada tecla digitada
      treinoInput.addEventListener('input', () => {
        const senha = treinoInput.value;
        
        if (senha.length === 0) {
          // Limpa tudo se o campo estiver vazio
          treinoMsg.textContent = '';
          barraProgresso.style.width = '0%';
          barraProgresso.style.backgroundColor = 'crimson';
          return;
        }

        // Calcula a for√ßa da senha
        const forca = calcularNivelSenha(senha);
        
        // Atualiza a interface
        treinoMsg.textContent = forca.msg;
        treinoMsg.style.color = forca.cor;
        
        barraProgresso.style.width = forca.larguraBarra + '%';
        barraProgresso.style.backgroundColor = forca.cor;
      });

      // Bot√£o de limpar o campo de treino
      btnLimpar.addEventListener('click', () => {
        treinoInput.value = '';
        // Dispara o evento 'input' manualmente para limpar a barra e a msg
        treinoInput.dispatchEvent(new Event('input')); 
      });

    });
  </script>
</body>
</html>
